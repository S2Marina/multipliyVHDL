/*
 * #define GO_BASE 0x21000
 * #define PRT_BASE 0x21010
 * #define M_BASE 0x21040
 * #define MULT_BASE 0x21030
 * #define RES_BASE 0x21020
 *
 */

#include <stdio.h>
#include "system.h"
#include "altera_avalon_performance_counter.h"

#define go (int *) 0x21000
#define prt (int *) 0x21010
#define m (long *) 0x21040
#define mult (long *) 0x21030
#define res (long *) 0x21020

int main()
{
  *m = 0;
  *mult = 0;
  printf("Hello from Nios II!\n");

  PERF_RESET(PERFORMANCE_COUNTER_0_BASE);
  PERF_START_MEASURING(PERFORMANCE_COUNTER_0_BASE);

  PERF_BEGIN(PERFORMANCE_COUNTER_0_BASE, 1);

  *go = 0;
  *prt = 0;
  *m = 2000;
  *mult = 10;

  printf("m: %i\n", sizeof(*m));
  printf("mult: %i\n", sizeof(*mult));

  *go = 1;

  while(*prt != 1){
	  //printf("Esperando...");
  }

  PERF_END(PERFORMANCE_COUNTER_0_BASE, 1);
  PERF_STOP_MEASURING(PERFORMANCE_COUNTER_0_BASE);

  printf("Resultado da multiplicacao %i x %i = %i\n", *m, *mult, *res);

  perf_print_formatted_report((void*) PERFORMANCE_COUNTER_0_BASE, ALT_CPU_FREQ, 1, "TOTAL");

  return 0;
}
